---
title: "merging_code"
author: "Leonardo Feitosa"
date: "27/07/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(reshape2)
library(rnaturalearth)
```

```{r}
# Create file paths
# Set directories
basedir <- "G:/Meu Drive/fish_mgmt_areas/data"
urudir <- file.path(basedir, "uruguay", "processed")
out_final <- file.path(basedir, "processed_files")
plotdir <- "figures"
```

```{r}

world <- ne_countries(scale = "medium", returnclass = "sf")
# read in the data

colombia <- st_read(file.path(out_final, "Colombia_shrimp_fisheries_zoning.gpkg"))

uru <- list.files(file.path(urudir),
                    pattern = "*.Rds",
                    full.names = TRUE)

uru_tbl <- sapply(uru, readRDS, simplify = FALSE) 

uru_tbl_2 <- uru_tbl %>% 
  bind_rows() %>% 
  mutate(species = str_to_lower(species)) 
```

```{r}
# wrangling and plotting
df_orig_geo <- df_orig %>% 
  st_drop_geometry()

stur_2_geo <- df_sturg %>% 
  st_drop_geometry()

nefsc_tbl_geo <- nefsc_tbl_2 %>%
  st_drop_geometry()

whale_geo <- df_whale %>% 
  st_drop_geometry()

df_orig_geo <- df_orig %>% 
  st_drop_geometry()

df_final_geo <- df_final %>% 
  st_drop_geometry()
```


```{r}
df_final_col <- colombia %>% 
  select(-dataset_esp)

df_final <- uru_tbl_2 %>%   
  mutate(pk_system_history = NA,
         fk_system = NA,
         name_english = dataset,
         name_local = dataset_esp,
         additional_descriptor = NA,
         code = NA,
         multispecies = NA,
         multispecies_comment = species,
         fk_system_type = NA,
         fk_system_category = type,
         fk_system_owner = agency,
         fk_system_subowner = NA,
         source = citation,
         source_date = created,
         usage = "Free use citing Dirección Nacional de Calidad y Evaluación Ambiental (DINACEA) as the source",
         lineage = "Downloaded and imported from the Ministry of Environment of Uruguay on 2022-07-28",
         comment = NA,
         created_by = "Leonardo Manir Feitosa",
         created_on = "2022-07-28",
         changed_by = NA,
         changed_on = NA,
         iso_a3 = "URY",
         area_name = zone_name) %>% 
  relocate(source, .before = source_date) %>% 
  relocate(iso_a3, .after = changed_on) %>% 
  mutate(multispecies = case_when(
    str_detect(multispecies_comment, "multi") ~ "1",
    TRUE ~ "0"
  )) %>%  
  filter(!is.na(name_local)) %>%
  select(-dataset, -country, -ocean, -region, -agency, -zone_id, -zone_name, -species, -type, -species_list, -citation, -dataset_esp, -created) 
```

```{r}
# export shapefile
st_write(df_final, file.path(out_final, "Uruguay_fishing_exclusion_zones2.gpkg"))
```
 
```{r}
ggplot() +
#  geom_sf(data = world) +
  geom_sf(data = df_final, aes(fill = area_name)) 
  coord_sf(xlim = c(-90, -50),
           ylim = c(20, 50))
```

```{r}
east_coast <- list.files(file.path(out_final),
                         pattern = "*.gpkg",
                         full.names = TRUE)

east_coast_tbl <- sapply(east_coast, st_read, simplify = FALSE)

alaska <- st_read(file.path(out_final, "USA_alaska.gpkg"))

west <- st_read(file_path(out_final, "USA_west.gpkg"))

east_coast_tbl_2 <- east_coast_tbl %>% 
  bind_rows() %>% 
  select(-source) %>% 
  rename(source = citation) %>% 
  relocate(source, .before = source_date)

ggplot() +
  geom_sf(data = east_coast_tbl_2, aes(fill = name_english),
          show.legend = F)

st_write(east_coast_tbl_2, file.path(out_final, "USA_east_final.gpkg"))
```























