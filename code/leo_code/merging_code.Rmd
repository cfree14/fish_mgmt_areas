---
title: "merging_code"
author: "Leonardo Feitosa"
date: "27/07/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(reshape2)
library(rnaturalearth)
```

```{r}
# Create file paths
# Set directories
basedir <- "G:/Meu Drive/fish_mgmt_areas/data"
bradir <- file.path(basedir, "brazil", "processed")
out_final <- file.path(basedir, "processed_files")
plotdir <- "figures"
```

```{r}
# reading world data from rnaturalearth to make verification plots
world <- ne_countries(scale = "medium", returnclass = "sf")

# read in the data built
suri_updated <- readRDS(file.path(outdir, "Suriname_fisheries_management_areas.Rds"))

brazil_all <- list.files(file.path(bradir),
                    pattern = "*.Rds",
                    full.names = TRUE)

brazil_all_tbl <- sapply(brazil_all, readRDS, simplify = FALSE) 

brazil_all_tbl_2 <- brazil_all_tbl %>% 
  bind_rows() %>% 
  mutate(species = str_to_lower(species)) 
```

```{r}
# removing geometry to inspect the data
df_orig_geo <- df_orig %>% 
  st_drop_geometry()
```


```{r}
# Data wrangling to final format accoding to the manual
df_final <- brazil_all_tbl_2 %>%   
  mutate(pk_system_history = NA,
         fk_system = NA,
         name_english = dataset,
         name_local = dataset_prt,
         additional_descriptor = NA,
         code = NA,
         multispecies = NA,
         multispecies_comment = species,
         fk_system_type = NA,
         fk_system_category = type,
         fk_system_owner = agency,
         fk_system_subowner = NA,
         source = citation,
         source_date = created,
         usage = "restricted",
         lineage = "Received by email from Rodrigo Barreto (rodrigorpbarreto@gmail.com) on 2022-04-18",
         comment = NA,
         created_by = "Leonardo Manir Feitosa",
         created_on = "2022-04-18",
         changed_by = NA,
         changed_on = NA,
         iso_a3 = "BRA",
         area_name = zone_name) %>% 
  relocate(source, .before = source_date) %>% 
  relocate(iso_a3, .after = changed_on) %>% 
  mutate(multispecies = case_when(
    str_detect(multispecies_comment, "multi") ~ "1",
    TRUE ~ "0"
  )) %>%  
  select(-dataset, -country, -ocean, -region, -agency, -zone_id, -zone_name, -species, -type, -citation, -created, -dataset_prt, -species_list) 
```

```{r}
# export shapefile
st_write(df_final, file.path(out_final, "Brazil_final.gpkg"))
```
 













